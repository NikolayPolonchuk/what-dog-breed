# Определение породы собаки по фото

Полончук Николай Андреевич

## Постановка задачи
Цель проекта – разработать модель машинного обучения для распознавания породы собак по фотографии собаки. Модель может быть использована для застенчивых любителей собак, которые очень хотят узнать породу понравившейся на улице собаки, но боятся подойти и прямо спросить.

### Формат входных и выходных данных
Входные данные: фотографии собак в формате .jpg, 120 различных пород, до препроцессинга имеют разные размеры, после препроцессинга размер будет 224 на 224 для стандартов ImageNet. 

Выходные данные: вектор вероятностей длины 120, пользователь будет получать наиболее вероятную породу.

### Метрики
Буду использовать Accuracy, ожидаю параметр в пределах 0.80-0.95, т.к. ошибки в схожих породах наверняка будут.

### Валидация и тест
Разделение данных - 90% train и 10% validation. Фиксируем seed для воспроизводимости, чтобы другие исследователи имели возможность повторить эксперимент и получить те же результаты. Так же это важно для честного сравнения разных методов на одинаковых данных и условиях.

### Датасеты
Источник: https://www.kaggle.com/competitions/dog-breed-identification/data.
Kaggle: Dog Breed Identification
Характеристики датасета: 20581 файл, общий вес 715МБ
Дисбаланс классов присутствует, но он мал: самая редкая порода имеет 66 фото, а самая распространённая – 126.

## Моделирование

### Бейзлайн
Небольшая свёрточная модель, обученная с нуля. Сможем сравнить насколько важно предобучение текущей модели.

### Основная модель
Основнaя модель - предобученная на ImageNet ViT-L-16. Будем использовать трансферное обучение, то есть заменим головку классификации, заморозим все параметры и дообучим на датасете.
https://docs.pytorch.org/vision/main/models/generated/torchvision.models.vit_l_16.html


### Внедрение
Интересно было бы сделать телеграмм-бота, чтобы можно было отправить фотографию собаки и он выдавал наиболее вероятную породу.

## Setup


Работал в VSCode на windows. В качетве терминала использовал git bash

```


# 0) Установить uv (если ещё не установлен)
# pip install uv

# 0.5) Клонировать репозиторий
git clone  https://github.com/NikolayPolonchuk/what-dog-breed

# 1) Создать виртуальное окружение
uv venv

# 2) И активировать его
source .venv/Scripts/activate

```

## Train

```

# 3) Скачивание данных с Kaggle и DVC
uv run -m dog_breeddetector.dataset.download_data
# для этого также необходимо скачать на kaggle kaggle.json и вставить в корневую папку компьютера .kaggle\ (создайте её при необходимости)

# 4) Обучение
uv run -m dog_breeddetector.train.train

```

## Production preparation

```
# 5) При необходимости можно выгрузить промежуточную модель (при завершении train вручную выгружать модель не надо)
uv run -m dog_breeddetector.exports.extract_model

# 6) Экспорт ONNX
uv run -m dog_breeddetector.exports.extract_model



```